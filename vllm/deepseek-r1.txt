
hf download deepseek-ai/DeepSeek-R1-Distill-Qwen-7B --local-dir deepseek

nohup vllm serve ./deepseek --max_model_len 2048 --served-model-name deepseek-r1:7b --gpu_memory_utilization 0.90 --tensor-parallel-size 1 --api_key abc123 --host localhost --port 7890 --trust_remote_code --reasoning-parser deepseek_r1 &
------------------------------------------------------------------------

from openai import OpenAI

client = OpenAI(
    base_url="http://localhost:7890/v1",  # 这里是 --host + --port 的组合
    api_key="abc123",  # 这里是 --api_key 的参数
)

messages = [
    {"role": "user", "content": "9.11 and 9.8, 哪个更大?"}
]
model="deepseek-r1:7b"
response = client.chat.completions.create(model=model, messages=messages)

reasoning_content = response.choices[0].message.reasoning_content
content = response.choices[0].message.content

print("reasoning_content:", reasoning_content)
print("content:", content)
------------------------------------------------------------------------

models = client.models.list()
models

model = models.data[0].id
model

------------------------------------------------------------------------
#如果要启用流式输出,则直接在调用时添加 stream=True 参数即可。如下代码所示:
from openai import OpenAI

client = OpenAI(
    base_url="http://localhost:7890/v1",  # 这里是 --host + --port 的组合
    api_key="abc123",  # 这里是 --api_key 的参数
)

messages = [
    {"role": "user", "content": "is 9.9 larger than 9.11"}
]
model="deepseek-r1:7b"

stream = client.chat.completions.create(model=model, messages=messages, stream=True)

print("开始流式输出...")
printed_reasoning_content = False
printed_content = False

for chunk in stream:
    reasoning_content = None
    content = None
    # 检查返回内容是否包含推理过程
    if hasattr(chunk.choices[0].delta, "reasoning_content"):
        reasoning_content = chunk.choices[0].delta.reasoning_content
    elif hasattr(chunk.choices[0].delta, "content"):
        content = chunk.choices[0].delta.content

    if reasoning_content is not None:
        if not printed_reasoning_content:
            printed_reasoning_content = True
            print("思考过程:", end="", flush=True)
        print(reasoning_content, end="", flush=True)
    elif content is not None:
        if not printed_content:
            printed_content = True
            print("\n生成文本:", end="", flush=True)

        # 打印生成文本
        print(content, end="", flush=True)